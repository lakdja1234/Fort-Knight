# 스테이지 2 기술 명세서

## 1. 개요 (Overview)

스테이지 2는 '쇄빙선'이라는 보스를 상대로 전투를 벌이는 보스전 스테이지입니다. 플레이어는 시간이 지남에 따라 얼어붙는 '냉동 게이지'를 관리하고, 폭발로 인해 녹았다가 다시 어는 '동적 얼음 타일맵' 위에서 전투를 치릅니다. 보스의 핵심 약점인 '온열 장치'들을 모두 파괴하여 보스를 과열시키고, 과열 상태의 보스를 공격하여 처치하는 것이 목표입니다.

---

## 2. 핵심 게임플레이 시스템 (Core Gameplay Systems)

### 2.1. 동적 얼음 타일맵 (`tile_map.gd`)

-   **얼음 녹이기**: 보스나 플레이어의 공격으로 발생하는 폭발(Explosion)은 주변의 얼음 타일을 '녹은 얼음' 타일로 변경합니다.
-   **얼어붙는 바람**: 15초마다 타이머(`RefreezeWindTimer`)가 작동하여 맵의 모든 '녹은 얼음' 타일을 원래의 얼음 타일로 되돌립니다. 이 때 맵에 있는 모든 환경 온열 장치도 함께 꺼집니다.
-   **타일 속성**: 각 타일은 `is_ice`라는 커스텀 데이터를 가지고 있어, 플레이어가 현재 얼음 위에 있는지 판별하는 데 사용됩니다.

### 2.2. 플레이어 냉동 시스템 (`player.gd`)

-   **냉동 게이지**: 플레이어는 `current_freeze_gauge`라는 변수를 가집니다. 이 게이지는 시간이 지남에 따라 `freeze_rate`만큼 자동으로 차오릅니다.
-   **기동력 저하**: 게이지가 100%가 되면 플레이어는 '얼어붙음(frozen)' 상태가 되어 이동 속도와 가속도가 50% 감소하는 디버프를 받습니다.
-   **해동**: '환경 온열 장치'의 범위 안에 들어가면 게이지가 `warm_rate`만큼 감소하며, 게이지가 0이 되면 '얼어붙음' 상태가 해제됩니다.
-   **얼음 위 움직임**: 플레이어는 얼음 타일 위에서 가속도가 낮아지고 마찰력이 거의 없는 미끄러지는 움직임을 보입니다.

### 2.3. 환경 온열 장치 (`heater.gd`)

-   **역할**: 맵 곳곳에 배치된 고정형 장치로, 플레이어의 '냉동 게이지'를 관리하는 데 도움을 줍니다.
-   **작동**: 플레이어의 포탄 등으로 켜거나 끌 수 있습니다.
-   **효과**: 켜져 있는 온열 장치의 `WarmAura` 범위 안에 플레이어가 들어가면 `is_warming_up` 상태가 되어 냉동 게이지가 감소합니다.
-   **그룹**: `"map_heaters"` 그룹에 속해있어 보스의 약점인 `"heaters"` 그룹과 구분됩니다.

---

## 3. 보스: 쇄빙선 (`쇄빙선.gd`)

### 3.1. 기본 정보

-   **HP**: `boss_hp` 변수로 관리되며, 초기값은 1000입니다.
-   **상태**: 일반 상태, 방어벽 생성(돌진) 상태, 과열 상태로 나뉩니다.

### 3.2. 핵심 약점: 온열 장치 (Heaters)

-   **개념**: 보스 '쇄빙선'에 부착된 파괴 가능한 부위들로, 보스의 핵심 약점입니다. 스크립트 내에서는 'heat sinks'로 지칭됩니다.
-   **그룹**: `"heaters"` 그룹에 속해있습니다.
-   **파괴**: 플레이어의 공격을 받으면 데미지를 입고 파괴됩니다.
-   **과열 트리거**: 맵에 있는 모든 온열 장치(`total_heat_sinks`)가 파괴되면(`heat_sinks_destroyed`), 보스는 '과열' 상태에 돌입합니다.
-   **방어벽 생성 요청**: 온열 장치의 HP가 50%가 되면 보스에게 `spawn_wall_requested` 시그널을 보내 방어벽 생성 패턴을 유도합니다.

### 3.3. 공격 패턴

-   **일반 포물선 공격 (`_on_attack_timer_timeout`)**:
    1.  플레이어의 예상 위치에 `warning_indicator` (경고 표시)를 생성합니다.
    2.  1.5초 후, 해당 위치로 `포탄.tscn`을 포물선 궤적으로 발사합니다.
    3.  포탄은 `explosion_radius` 만큼의 폭발을 일으켜 얼음 타일을 녹입니다.
-   **유도 미사일 공격 (`_on_homing_missile_timer_timeout`)**:
    1.  경고 표시 없이 `homing_missile.tscn`을 즉시 발사합니다.
    2.  미사일은 처음에는 포물선으로 날아가다가, 플레이어와 일정 거리(`homing_activation_range`) 내로 가까워지면 중력을 무시하고 플레이어를 향해 한 번 방향을 꺾어 돌진합니다.

### 3.4. 방어 패턴

-   **얼음 방어벽 생성 (`spawn_ice_wall`)**:
    1.  온열 장치의 HP가 50%가 되면 `_on_spawn_wall_requested` 함수가 호출됩니다.
    2.  보스는 플레이어 반대편의 벽을 향해 `WALL_CHARGE_SPEED`로 돌진합니다.
    3.  벽에 부딪히면, 그 자리에 `iceWall.tscn`을 생성합니다.
    4.  생성된 얼음벽은 2의 HP를 가지며, 플레이어의 공격으로 파괴 가능합니다.
    5.  보스는 자신의 공격 궤도에 얼음벽이 있으면 더 높은 각도로 공격을 발사하여 벽을 넘기려 시도합니다.

### 3.5. 과열 및 처치

-   **과열 상태 (`start_overheating`)**:
    -   모든 온열 장치가 파괴되면 돌입하는 행동 불능 상태입니다.
    -   모든 공격 타이머가 중지됩니다.
    -   1초마다 `_on_overheat_timer_timeout` 함수가 호출되어 스스로 100의 데미지를 입습니다.
-   **처치**: `take_damage` 함수를 통해 `boss_hp`가 0 이하가 되면 보스는 처치됩니다.

---

## 4. 주요 객체 및 스크립트 (Key Objects & Scripts)

-   **`스테이지2.tscn`**: 스테이지의 모든 노드(타일맵, 보스, 플레이어, 온열 장치 등)를 배치하는 메인 씬 파일.
-   **`tile_map.gd`**: 얼음 타일의 '녹음'과 '재결빙' 로직을 관리.
-   **`player.gd`**: 플레이어의 움직임, 얼음 위에서의 마찰력, 냉동 게이지 시스템을 관리.
-   **`쇄빙선.gd`**: 보스의 모든 행동(공격, 방어, 과열)과 생명 주기를 제어하는 핵심 스크립트.
-   **`heater.gd`**: 플레이어가 냉동 게이지를 관리하기 위해 상호작용하는 환경 오브젝트 로직.
-   **`포탄.gd` / `homing_missile.gd`**: 각각 일반 포탄과 유도 미사일의 비행, 충돌, 폭발 로직을 담당.
-   **`iceWall.gd`**: 보스가 생성하는 방어벽의 생명력과 파괴 로직을 담당.